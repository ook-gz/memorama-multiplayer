<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Partidas activas (Tiempo real)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    .ganador { font-weight: bold; color: green; }
    .pendiente { color: #999; }
  </style>
</head>
<body>
  <h1>Partidas en tiempo real</h1>
  <div id="contenedor"></div>
  <script src="colyseus.js"></script>
  <script type="module">
    const client = new window.Colyseus.Client("http://192.168.0.27:2567");

    async function listarPartidas() {
        // üëá nota: usamos Colyseus.Client (clase), no client (instancia)
        const salas = await window.Colyseus.Client.getAvailableRooms("memorama");
        console.log("üîç Partidas activas:", salas);

        // Ejemplo: mostrarlas en el contenedor
        const contenedor = document.getElementById("contenedor");
        contenedor.innerHTML = salas.map(sala => `
            <div>
            <strong>ID:</strong> ${sala.roomId}<br>
            <strong>Jugadores:</strong> ${sala.clients}/${sala.maxClients}<br>
            <strong>Metadata:</strong> ${JSON.stringify(sala.metadata)}
            </div>
            <hr>
        `).join("");
        }

    // Llamar la funci√≥n
    listarPartidas();
    /*

    async function conectarPartida() {
      try {
        // ‚ö†Ô∏è Unirse a una sala de espectador (sin registrar jugador)
        const room = await client.joinOrCreate("memorama", { espectador: true });

        // Render inicial del estado
        renderizar(room.state);

        // Cada vez que cambie algo en el state
        room.state.onChange = (changes) => {
          renderizar(room.state);
        };

        // Escuchar mensajes especiales
        room.onMessage("ganador", (data) => {
          console.log("Ganador anunciado:", data);
        });

      } catch (err) {
        console.error("‚ùå Error conectando como espectador:", err);
      }
    }

    function renderizar(state) {
      if (!state) return;
      contenedor.innerHTML = "";

      const tabla = document.createElement("table");
      tabla.innerHTML = `
        <thead>
          <tr>
            <th>Jugador</th>
            <th>Sucursal</th>
            <th>Tiempo</th>
            <th>Estado</th>
          </tr>
        </thead>
      `;

      const tbody = document.createElement("tbody");
      for (const [id, j] of Object.entries(state.jugadores)) {
        const tr = document.createElement("tr");

        // Nombre
        const tdNombre = document.createElement("td");
        tdNombre.textContent = j.nombre;
        if (state.ganador === id) tdNombre.classList.add("ganador");
        tr.appendChild(tdNombre);

        // Sucursal
        const tdSucursal = document.createElement("td");
        tdSucursal.textContent = j.sucursal;
        tr.appendChild(tdSucursal);

        // Tiempo
        const tdTiempo = document.createElement("td");
        tdTiempo.textContent = j.tiempo + "s";
        tr.appendChild(tdTiempo);

        // Estado
        const tdEstado = document.createElement("td");
        tdEstado.textContent = j.terminado ? "‚úÖ Terminado" : "‚è≥ Jugando";
        tr.appendChild(tdEstado);

        tbody.appendChild(tr);
      }
      tabla.appendChild(tbody);
      contenedor.appendChild(tabla);
    }

    conectarPartida();
    */
  </script>
</body>
</html>
